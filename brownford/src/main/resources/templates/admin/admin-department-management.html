<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brown Ford University - Department Management</title>
    <!-- Link to the external CSS files -->
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar-nav.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <link
        href="https://fonts.googleapis.com/css2?family=Alice&family=Cinzel&family=Cinzel+Decorative&family=Cormorant+Garamond&display=swap"
        rel="stylesheet" />
</head>

<body>
    <div class="background-container">
        <div class="background-image"></div>

        <!-- Header -->
        <header class="header">
            <button class="sidebar-toggle" id="sidebarToggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="#8B4513" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <div class="logo-container">
                <div class="logo">
                    <div class="logo-inner">
                        <img th:src="@{/images/logo.png}" alt="Brown Ford University Logo" class="university-logo">
                    </div>
                </div>
                <h1 class="university-name">Brown Ford University</h1>
            </div>
            <div class="header-icons">
                <!-- Notification Icon -->
                <div class="notification-icon">
                    <a href="#" class="notification-link" id="notificationToggle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="#8B4513" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                    </a>
                    <!-- Notification Dropdown -->
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <h3>Notifications</h3>
                            <a href="#" class="mark-all-read">Mark all as read</a>
                        </div>
                        <div class="notification-list">
                            <p>No notifications available.</p>
                        </div>
                        <div class="notification-footer">
                            <a href="#" class="view-all">View All Notifications</a>
                        </div>
                    </div>
                </div>

                <!-- Interactive Logout Icon as an anchor tag -->
                <div class="logout-icon">
                    <a th:href="@{/logout}" class="logout-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="#8B4513" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                        </svg>
                    </a>
                </div>
            </div>
        </header>

        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <img th:src="@{/images/logo.png}" alt="Brown Ford University Logo">
                    <span class="sidebar-title">Admin Portal</span>
                </div>
                <button class="sidebar-close" id="sidebarClose">&times;</button>
            </div>
            <div class="sidebar-content">
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item">
                        <a th:href="@{/admin-dashboard}" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                            </span>
                            <span class="sidebar-nav-text">Dashboard</span>
                        </a>
                    </li>

                    <div class="sidebar-section-title">Academic Management</div>

                    <li class="sidebar-nav-item active">
                        <a th:href="@{/admin-department-management}" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                            </span>
                            <span class="sidebar-nav-text">Departments</span>
                        </a>
                    </li>

                    <li class="sidebar-nav-item">
                        <a th:href="@{/admin-courses}" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                                </svg>
                            </span>
                            <span class="sidebar-nav-text">Courses</span>
                        </a>
                    </li>

                    <li class="sidebar-nav-item">
                        <a th:href="@{/admin-sections}" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </span>
                            <span class="sidebar-nav-text">Sections</span>
                        </a>
                    </li>

                    <li class="sidebar-nav-item">
                        <a th:href="@{/admin-subject-management}" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                            </span>
                            <span class="sidebar-nav-text">Subject Management</span>
                        </a>
                    </li>

                    <li class="sidebar-nav-item">
                        <a th:href="@{/admin-enrollment}" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="8.5" cy="7" r="4"></circle>
                                    <line x1="20" y1="8" x2="20" y2="14"></line>
                                    <line x1="23" y1="11" x2="17" y2="11"></line>
                                </svg>
                            </span>
                            <span class="sidebar-nav-text">Enrollment</span>
                        </a>
                    </li>

                    <div class="sidebar-section-title">User Management</div>

                    <li class="sidebar-nav-item">
                        <a th:href="@{/admin-users}" class="sidebar-nav-link">
                            <span class="sidebar-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </span>
                            <span class="sidebar-nav-text">User Management</span>
                        </a>
                    </li>

                    <li class="sidebar-nav-item sidebar-dropdown">
                        <button class="sidebar-dropdown-toggle">
                            <span class="sidebar-dropdown-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="8.5" cy="7" r="4"></circle>
                                    <line x1="20" y1="8" x2="20" y2="14"></line>
                                    <line x1="23" y1="11" x2="17" y2="11"></line>
                                </svg>
                            </span>
                            <span class="sidebar-dropdown-text">Faculty</span>
                            <span class="sidebar-dropdown-arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a th:href="@{/admin-faculty-list}" class="sidebar-dropdown-item">Faculty List</a>
                            <a th:href="@{/admin-faculty-workload}" class="sidebar-dropdown-item">Workload
                                Management</a>
                            <a th:href="@{/admin-faculty-evaluation}" class="sidebar-dropdown-item">Evaluations</a>
                        </div>
                    </li>

                    <li class="sidebar-nav-item sidebar-dropdown">
                        <button class="sidebar-dropdown-toggle">
                            <span class="sidebar-dropdown-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                </svg>
                            </span>
                            <span class="sidebar-dropdown-text">Students</span>
                            <span class="sidebar-dropdown-arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </span>
                        </button>
                        <div class="sidebar-dropdown-menu">
                            <a th:href="@{/admin-student-list}" class="sidebar-dropdown-item">Student List</a>
                            <a th:href="@{/admin-student-records}" class="sidebar-dropdown-item">Academic Records</a>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="sidebar-footer">
                <p>Brown Ford University &copy; 2025</p>
                <p>Admin Portal v1.0</p>
            </div>
        </div>

        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <div class="content-wrapper" id="contentWrapper">
            <main class="dashboard-content">
                <!-- Header Section (Welcome) -->
                <section class="welcome-section">
                    <div class="welcome-header">
                        <div class="welcome-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"
                                fill="none" stroke="#6B3A1D" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </div>
                        <div class="welcome-text">
                            <h2>Department Management</h2>
                            <p>Manage academic departments and their details</p>
                        </div>
                    </div>
                </section>

                <!-- Department Content -->
                <section class="content-panel">
                    <div class="panel-header">
                        <h2 class="section-title">Department Management</h2>
                    </div>
                    <div class="panel-content">
                        <!-- Search and Filter Controls -->
                        <div class="user-controls">
                            <div class="search-filter-container">
                                <div class="search-container">
                                    <input type="text" placeholder="Search departments..." id="departmentSearchInput">
                                    <button class="search-button">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                        </svg>
                                    </button>
                                </div>
                                <div class="filter-container">
                                    <select id="statusFilter" class="filter-select">
                                        <option value="all">All Status</option>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button id="addDepartmentBtn" class="add-user-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                        <line x1="12" y1="11" x2="12" y2="17"></line>
                                        <line x1="9" y1="14" x2="15" y2="14"></line>
                                    </svg>
                                    Add New Department
                                </button>
                                <button id="exportDepartmentsBtn" class="export-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Export
                                </button>
                            </div>
                        </div>

                        <!-- Departments Table -->
                        <div class="table-container">
                            <table class="data-table" id="departmentTable">
                                <thead>
                                    <tr>
                                        <th>Department Code</th>
                                        <th>Department Name</th>
                                        <th>Description</th>
                                        <th>Faculty Count</th>
                                        <th>Course Count</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="departmentTableBody">
                                    <!-- Department data will be loaded dynamically -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="pagination" id="departmentPaginationContainer">
                            <div class="empty-pagination-message">
                                <p>Pagination will appear when there are enough records to display multiple pages.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Add Department Modal -->
        <div id="departmentModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="departmentModalTitle">Add New Department</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="departmentForm">
                        <input type="hidden" id="departmentId" name="departmentId">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="departmentCode">Department Code</label>
                                <input type="text" id="departmentCode" name="departmentCode" class="form-control"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="departmentName">Department Name</label>
                                <input type="text" id="departmentName" name="departmentName" class="form-control"
                                    required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="departmentDescription">Description</label>
                            <textarea id="departmentDescription" name="departmentDescription" class="form-control"
                                rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="departmentStatus">Status</label>
                            <select id="departmentStatus" name="departmentStatus" class="form-control" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelDepartmentBtn">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="saveDepartmentBtn">Save
                                Department</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- View Department Details Modal -->
        <div id="viewDepartmentModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Department Details</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="department-details">
                        <div class="department-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24"
                                fill="none" stroke="#6B3A1D" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </div>
                        <div class="department-info-grid">
                            <div class="info-item">
                                <span class="info-label">Department Code:</span>
                                <span class="info-value" id="viewDepartmentCode"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Department Name:</span>
                                <span class="info-value" id="viewDepartmentName"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Status:</span>
                                <span class="info-value" id="viewDepartmentStatus"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Faculty Count:</span>
                                <span class="info-value" id="viewFacultyCount"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Course Count:</span>
                                <span class="info-value" id="viewCourseCount"></span>
                            </div>
                        </div>
                        <div class="department-description">
                            <h4>Description</h4>
                            <p id="viewDepartmentDescription"></p>
                        </div>
                    </div>
                    <div class="department-actions">
                        <button class="btn btn-secondary" id="closeViewDepartmentBtn">Close</button>
                        <button class="btn btn-primary" id="editFromViewDepartmentBtn">Edit Department</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteConfirmModal" class="modal">
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h3 id="deleteConfirmTitle">Confirm Deletion</h3>
                    <span class="close-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmMessage">Are you sure you want to delete this department? This action cannot be
                        undone.</p>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/js/notifications.js}"></script>
    <script th:src="@{/js/sidebar-nav.js}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Modal elements
            const departmentModal = document.getElementById('departmentModal');
            const viewDepartmentModal = document.getElementById('viewDepartmentModal');
            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            const addDepartmentBtn = document.getElementById('addDepartmentBtn');
            const closeModalBtns = document.querySelectorAll('.close-modal');
            const cancelDepartmentBtn = document.getElementById('cancelDepartmentBtn');
            const closeViewDepartmentBtn = document.getElementById('closeViewDepartmentBtn');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');

            let editingDepartmentId = null;

            // Load departments on page load
            loadDepartments();

            // Open add department modal
            addDepartmentBtn.addEventListener('click', function () {
                document.getElementById('departmentModalTitle').textContent = 'Add New Department';
                document.getElementById('departmentForm').reset();
                editingDepartmentId = null;
                departmentModal.style.display = 'block';
            });

            // Close all modals
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', function () {
                    departmentModal.style.display = 'none';
                    viewDepartmentModal.style.display = 'none';
                    deleteConfirmModal.style.display = 'none';
                });
            });

            cancelDepartmentBtn.addEventListener('click', function () {
                departmentModal.style.display = 'none';
            });

            closeViewDepartmentBtn.addEventListener('click', function () {
                viewDepartmentModal.style.display = 'none';
            });

            cancelDeleteBtn.addEventListener('click', function () {
                deleteConfirmModal.style.display = 'none';
            });

            // Department form submission
            document.getElementById('departmentForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const formData = {
                    code: document.getElementById('departmentCode').value,
                    name: document.getElementById('departmentName').value,
                    description: document.getElementById('departmentDescription').value,
                    status: document.getElementById('departmentStatus').value
                };

                try {
                    let url = '/api/departments';
                    let method = 'POST';
                    if (editingDepartmentId) {
                        url += '/' + editingDepartmentId;
                        method = 'PUT';
                    }

                    const response = await fetch(url, {
                        method: method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) throw new Error('Failed to save department');

                    departmentModal.style.display = 'none';
                    loadDepartments();
                } catch (err) {
                    alert('Error saving department: ' + err.message);
                }
            });

            // Search functionality
            document.getElementById('departmentSearchInput').addEventListener('keyup', function () {
                const searchTerm = this.value.trim().toLowerCase();
                filterTableRows('departmentTable', searchTerm);
            });

            // Filter functionality
            document.getElementById('statusFilter').addEventListener('change', function () {
                const status = this.value;
                filterTableByStatus('departmentTable', status);
            });

            // Export functionality
            document.getElementById('exportDepartmentsBtn').addEventListener('click', function () {
                // Implement export logic here
                alert('Export functionality would be implemented here');
            });

            // Helper function to filter table rows
            function filterTableRows(tableId, term) {
                const rows = document.querySelectorAll(`#${tableId} tbody tr`);
                rows.forEach(row => {
                    if (row.classList.contains('empty-state-row')) return;
                    row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
                });
            }

            // Helper function to filter by status
            function filterTableByStatus(tableId, status) {
                const rows = document.querySelectorAll(`#${tableId} tbody tr`);
                rows.forEach(row => {
                    if (row.classList.contains('empty-state-row')) return;
                    if (status === 'all') {
                        row.style.display = '';
                    } else {
                        const statusCell = row.querySelector('td:nth-child(6)');
                        row.style.display = statusCell.textContent.toLowerCase() === status ? '' : 'none';
                    }
                });
            }
        });

        // Load departments from the API
        async function loadDepartments() {
            try {
                const response = await fetch('/api/departments');
                if (!response.ok) throw new Error('Failed to fetch departments');
                const departments = await response.json();
                populateDepartmentsTable(departments);
            } catch (error) {
                console.error('Error loading departments:', error);
                const tbody = document.getElementById('departmentTableBody');
                tbody.innerHTML = `<tr class="empty-state-row"><td colspan="7" class="empty-state-message"><div class="empty-state"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#8B4513" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg><p>Failed to load departments.</p></div></td></tr>`;
            }
        }

        // Populate departments table
        function populateDepartmentsTable(departments) {
            const tbody = document.getElementById('departmentTableBody');
            if (!departments || departments.length === 0) {
                tbody.innerHTML = `<tr class="empty-state-row"><td colspan="7" class="empty-state-message"><div class="empty-state"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#8B4513" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg><p>No departments found. Add departments or adjust your search filters to see results.</p></div></td></tr>`;
                return;
            }

            tbody.innerHTML = departments.map(dept => `
                <tr>
                    <td>${dept.code}</td>
                    <td>${dept.name}</td>
                    <td>${dept.description || 'No description'}</td>
                    <td>${dept.facultyCount || 0}</td>
                    <td>${dept.courseCount || 0}</td>
                    <td><span class="status-badge ${dept.status === 'active' ? 'active' : 'inactive'}">${dept.status || 'active'}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="action-btn btn-view" data-id="${dept.id}" title="View Details">View</button>
                            <button class="action-btn btn-edit" data-id="${dept.id}" title="Edit Department">Edit</button>
                            <button class="action-btn btn-delete" data-id="${dept.id}" title="Delete Department">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Add event listeners for action buttons
            addActionButtonListeners();
        }

        // Add event listeners for action buttons
        function addActionButtonListeners() {
            // View buttons
            document.querySelectorAll('.btn-view').forEach(btn => {
                btn.addEventListener('click', function () {
                    const deptId = this.getAttribute('data-id');
                    viewDepartment(deptId);
                });
            });

            // Edit buttons
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', function () {
                    const deptId = this.getAttribute('data-id');
                    editDepartment(deptId);
                });
            });

            // Delete buttons
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', function () {
                    const deptId = this.getAttribute('data-id');
                    deleteDepartment(deptId);
                });
            });
        }

        // View department details
        async function viewDepartment(deptId) {
            try {
                const response = await fetch(`/api/departments/${deptId}`);
                if (!response.ok) throw new Error('Failed to fetch department');
                const dept = await response.json();

                document.getElementById('viewDepartmentCode').textContent = dept.code;
                document.getElementById('viewDepartmentName').textContent = dept.name;
                document.getElementById('viewDepartmentStatus').innerHTML = `<span class="status-badge ${dept.status === 'active' ? 'active' : 'inactive'}">${dept.status}</span>`;
                document.getElementById('viewFacultyCount').textContent = dept.facultyCount || 0;
                document.getElementById('viewCourseCount').textContent = dept.courseCount || 0;
                document.getElementById('viewDepartmentDescription').textContent = dept.description || 'No description available';

                document.getElementById('viewDepartmentModal').style.display = 'block';
            } catch (error) {
                alert('Error loading department details: ' + error.message);
            }
        }

        // Edit department
        async function editDepartment(deptId) {
            try {
                const response = await fetch(`/api/departments/${deptId}`);
                if (!response.ok) throw new Error('Failed to fetch department');
                const dept = await response.json();

                document.getElementById('departmentModalTitle').textContent = 'Edit Department';
                document.getElementById('departmentCode').value = dept.code;
                document.getElementById('departmentName').value = dept.name;
                document.getElementById('departmentDescription').value = dept.description || '';
                document.getElementById('departmentStatus').value = dept.status || 'active';

                editingDepartmentId = deptId;
                document.getElementById('departmentModal').style.display = 'block';
            } catch (error) {
                alert('Error loading department for editing: ' + error.message);
            }
        }

        // Delete department
        function deleteDepartment(deptId) {
            document.getElementById('deleteConfirmTitle').textContent = 'Delete Department';
            document.getElementById('deleteConfirmMessage').textContent = 'Are you sure you want to delete this department? This action cannot be undone and may affect related courses and faculty.';

            document.getElementById('confirmDeleteBtn').onclick = async function () {
                try {
                    const response = await fetch(`/api/departments/${deptId}`, { method: 'DELETE' });
                    if (!response.ok) throw new Error('Failed to delete department');

                    document.getElementById('deleteConfirmModal').style.display = 'none';
                    loadDepartments();
                } catch (error) {
                    alert('Error deleting department: ' + error.message);
                }
            };

            document.getElementById('deleteConfirmModal').style.display = 'block';
        }
    </script>

    <style>
        /* Empty state styles */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }

        .empty-state svg {
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .empty-state p {
            color: #666;
            font-size: 0.95rem;
        }

        .empty-state-message {
            text-align: center;
        }

        .empty-pagination-message {
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            padding: 0.5rem;
            font-style: italic;
        }

        /* Action buttons styling */
        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .add-user-btn,
        .export-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            font-family: "Cinzel", serif;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .add-user-btn {
            background-color: #8B4513;
            color: white;
        }

        .add-user-btn:hover {
            background-color: #6B3A1D;
        }

        .export-btn {
            background-color: #f0f0f0;
            color: #333;
        }

        .export-btn:hover {
            background-color: #e0e0e0;
        }

        /* Table action buttons */
        .table-actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-family: "Cinzel", serif;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            min-width: 60px;
            text-align: center;
        }

        .btn-view,
        .btn-edit {
            background-color: #8B4513;
            color: white;
        }

        .btn-view:hover,
        .btn-edit:hover {
            background-color: #6B3A1D;
        }

        .btn-delete {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-delete:hover {
            background-color: #e0e0e0;
        }

        /* Status badges */

        .modal-sm {
            max-width: 400px;
        }

        .close-modal {
            font-size: 24px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
        }

        .close-modal:hover {
            color: #333;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
            font-family: "Cinzel", serif;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #8B4513;
            color: white;
        }

        .btn-primary:hover {
            background-color: #6B3A1D;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        /* Department details view */
        .department-details {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .department-icon {
            text-align: center;
            margin-bottom: 20px;
        }

        .department-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            font-weight: bold;
            color: #666;
            font-size: 0.9rem;
        }

        .info-value {
            color: #333;
            font-size: 1rem;
        }

        .department-description {
            width: 100%;
            margin-top: 20px;
        }

        .department-description h4 {
            color: #8B4513;
            margin-bottom: 10px;
            font-family: "Cinzel", serif;
        }

        .department-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</body>

</html>